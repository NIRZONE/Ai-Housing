<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI House Price Prediction Project</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-5px);
        }
        
        .section h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .data-input {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #4a5568;
        }
        
        .input-group input, .input-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.3);
        }
        
        .result-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .result-card .value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .data-table {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .insights {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .insights h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .insights ul {
            list-style-type: none;
            padding: 0;
        }
        
        .insights li {
            background: rgba(255, 255, 255, 0.7);
            margin: 8px 0;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† AI House Price Prediction System</h1>
            <p>Machine Learning Model for Real Estate Price Forecasting</p>
        </div>
        
        <div class="section">
            <h2>üìä Project Overview</h2>
            <p>This AI project implements a <strong>Multiple Linear Regression</strong> algorithm to predict house prices based on various features. The model analyzes relationships between property characteristics and market values to provide accurate price predictions.</p>
            
            <div class="insights">
                <h3>üéØ Real-World Impact</h3>
                <ul>
                    <li><strong>Real Estate Professionals:</strong> Agents can provide accurate property valuations instantly</li>
                    <li><strong>Home Buyers:</strong> Make informed decisions with price predictions before viewing properties</li>
                    <li><strong>Investors:</strong> Identify undervalued properties and investment opportunities</li>
                    <li><strong>Banks & Lenders:</strong> Assess property values for mortgage and loan decisions</li>
                    <li><strong>Urban Planning:</strong> Understand housing market trends for city development</li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <h2>üóÉÔ∏è Dataset Generation & Preprocessing</h2>
            <button class="btn" onclick="generateDataset()">Generate Sample Dataset</button>
            <button class="btn" onclick="downloadCSV()">üì• Download CSV Dataset</button>
            <button class="btn" onclick="preprocessData()">Preprocess Data</button>
            
            <div class="loading" id="dataLoading">
                <div class="spinner"></div>
                <p>Generating realistic housing dataset...</p>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            
            <div class="data-table" id="datasetTable" style="display: none;">
                <h3>Sample Dataset (First 10 Records)</h3>
                <table id="sampleData">
                    <thead>
                        <tr>
                            <th>Size (sq ft)</th>
                            <th>Bedrooms</th>
                            <th>Bathrooms</th>
                            <th>Age (years)</th>
                            <th>Garage</th>
                            <th>Location Score</th>
                            <th>Amenity Score</th>
                            <th>Price ($)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>ü§ñ Machine Learning Model Training</h2>
            <button class="btn" onclick="trainModel()">Train Linear Regression Model</button>
            
            <div class="results" id="modelResults" style="display: none;">
                <div class="result-card">
                    <h3>Model Accuracy</h3>
                    <div class="value" id="accuracy">--</div>
                </div>
                <div class="result-card">
                    <h3>R¬≤ Score</h3>
                    <div class="value" id="r2Score">--</div>
                </div>
                <div class="result-card">
                    <h3>Mean Error</h3>
                    <div class="value" id="meanError">--</div>
                </div>
                <div class="result-card">
                    <h3>Training Time</h3>
                    <div class="value" id="trainingTime">--</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>üè° House Price Prediction</h2>
            <div class="data-input">
                <div class="input-group">
                    <label for="houseSize">House Size (sq ft)</label>
                    <input type="number" id="houseSize" placeholder="e.g., 2000" value="2000">
                </div>
                <div class="input-group">
                    <label for="bedrooms">Bedrooms</label>
                    <input type="number" id="bedrooms" placeholder="e.g., 3" value="3">
                </div>
                <div class="input-group">
                    <label for="bathrooms">Bathrooms</label>
                    <input type="number" id="bathrooms" placeholder="e.g., 2" value="2" step="0.5">
                </div>
                <div class="input-group">
                    <label for="houseAge">House Age (years)</label>
                    <input type="number" id="houseAge" placeholder="e.g., 10" value="10">
                </div>
                <div class="input-group">
                    <label for="garage">Garage</label>
                    <select id="garage">
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="locationScore">Location Score (1-10)</label>
                    <input type="number" id="locationScore" placeholder="e.g., 8" value="8" min="1" max="10">
                </div>
                <div class="input-group">
                    <label for="amenityScore">Amenity Score (1-10)</label>
                    <input type="number" id="amenityScore" placeholder="e.g., 7" value="7" min="1" max="10">
                </div>
            </div>
            
            <button class="btn" onclick="predictPrice()">üîÆ Predict House Price</button>
            
            <div id="predictionResult" style="display: none; margin-top: 20px;">
                <div class="result-card" style="grid-column: 1 / -1;">
                    <h3>Predicted House Price</h3>
                    <div class="value" id="predictedPrice">$--</div>
                    <p id="confidenceLevel" style="margin-top: 10px; font-size: 0.9em;"></p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>üìà Data Visualization & Analysis</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px;">
                <div class="chart-container">
                    <canvas id="priceDistributionChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="featureCorrelationChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="actualVsPredictedChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="residualChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>üß† Model Insights & Interpretation</h2>
            <div id="modelInsights">
                <div class="insights">
                    <h3>üìã Key Findings</h3>
                    <ul id="keyFindings">
                        <li>Generate dataset and train model to see insights...</li>
                    </ul>
                </div>
                
                <div class="insights">
                    <h3>üîç Feature Importance</h3>
                    <ul id="featureImportance">
                        <li>Train the model to analyze feature importance...</li>
                    </ul>
                </div>
                
                <div class="insights">
                    <h3>üí° Business Recommendations</h3>
                    <ul id="businessRecommendations">
                        <li>Complete analysis to generate recommendations...</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let dataset = [];
        let model = null;
        let charts = {};
        
        // Linear Regression Implementation
        class LinearRegression {
            constructor() {
                this.weights = null;
                this.bias = null;
                this.trained = false;
            }
            
            fit(X, y) {
                const startTime = Date.now();
                
                // Add bias column (column of ones)
                const X_with_bias = X.map(row => [1, ...row]);
                
                // Convert to matrices
                const X_matrix = X_with_bias;
                const y_vector = y;
                
                // Normal equation: theta = (X^T * X)^(-1) * X^T * y
                const X_transpose = this.transpose(X_matrix);
                const XtX = this.multiply(X_transpose, X_matrix);
                const XtX_inv = this.inverse(XtX);
                const Xty = this.multiplyVector(X_transpose, y_vector);
                const theta = this.multiplyVector(XtX_inv, Xty);
                
                this.bias = theta[0];
                this.weights = theta.slice(1);
                this.trained = true;
                
                const endTime = Date.now();
                return endTime - startTime;
            }
            
            predict(X) {
                if (!this.trained) {
                    throw new Error('Model must be trained first');
                }
                
                return X.map(row => {
                    let prediction = this.bias;
                    for (let i = 0; i < row.length; i++) {
                        prediction += this.weights[i] * row[i];
                    }
                    return prediction;
                });
            }
            
            // Matrix operations
            transpose(matrix) {
                return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));
            }
            
            multiply(A, B) {
                const result = [];
                for (let i = 0; i < A.length; i++) {
                    result[i] = [];
                    for (let j = 0; j < B[0].length; j++) {
                        let sum = 0;
                        for (let k = 0; k < B.length; k++) {
                            sum += A[i][k] * B[k][j];
                        }
                        result[i][j] = sum;
                    }
                }
                return result;
            }
            
            multiplyVector(matrix, vector) {
                return matrix.map(row => 
                    row.reduce((sum, val, idx) => sum + val * vector[idx], 0)
                );
            }
            
            inverse(matrix) {
                const n = matrix.length;
                const identity = Array(n).fill().map((_, i) => 
                    Array(n).fill().map((_, j) => i === j ? 1 : 0)
                );
                
                // Augment matrix with identity
                const augmented = matrix.map((row, i) => [...row, ...identity[i]]);
                
                // Gaussian elimination
                for (let i = 0; i < n; i++) {
                    // Find pivot
                    let maxRow = i;
                    for (let k = i + 1; k < n; k++) {
                        if (Math.abs(augmented[k][i]) > Math.abs(augmented[maxRow][i])) {
                            maxRow = k;
                        }
                    }
                    [augmented[i], augmented[maxRow]] = [augmented[maxRow], augmented[i]];
                    
                    // Make diagonal 1
                    const pivot = augmented[i][i];
                    for (let k = 0; k < 2 * n; k++) {
                        augmented[i][k] /= pivot;
                    }
                    
                    // Eliminate column
                    for (let k = 0; k < n; k++) {
                        if (k !== i) {
                            const factor = augmented[k][i];
                            for (let j = 0; j < 2 * n; j++) {
                                augmented[k][j] -= factor * augmented[i][j];
                            }
                        }
                    }
                }
                
                // Extract inverse matrix
                return augmented.map(row => row.slice(n));
            }
        }
        
        // Generate realistic housing dataset
        function generateDataset() {
            document.getElementById('dataLoading').style.display = 'block';
            document.getElementById('progressBar').style.width = '0%';
            
            setTimeout(() => {
                dataset = [];
                const numSamples = 1000;
                
                for (let i = 0; i < numSamples; i++) {
                    const size = Math.floor(Math.random() * 3000) + 800; // 800-3800 sq ft
                    const bedrooms = Math.floor(Math.random() * 5) + 1; // 1-5 bedrooms
                    const bathrooms = Math.floor((Math.random() * 4 + 1) * 2) / 2; // 1-4.5 bathrooms
                    const age = Math.floor(Math.random() * 50); // 0-50 years
                    const garage = Math.random() > 0.3 ? 1 : 0; // 70% have garage
                    const locationScore = Math.floor(Math.random() * 10) + 1; // 1-10
                    const amenityScore = Math.floor(Math.random() * 10) + 1; // 1-10
                    
                    // Calculate price with realistic relationships
                    let price = 50000; // Base price
                    price += size * 120; // $120 per sq ft
                    price += bedrooms * 15000; // $15k per bedroom
                    price += bathrooms * 10000; // $10k per bathroom
                    price -= age * 2000; // Depreciation
                    price += garage * 25000; // Garage premium
                    price += locationScore * 30000; // Location premium
                    price += amenityScore * 8000; // Amenity premium
                    
                    // Add some noise
                    price += (Math.random() - 0.5) * 50000;
                    price = Math.max(price, 80000); // Minimum price
                    
                    dataset.push({
                        size, bedrooms, bathrooms, age, garage, 
                        locationScore, amenityScore, price: Math.round(price)
                    });
                    
                    // Update progress
                    document.getElementById('progressBar').style.width = `${(i + 1) / numSamples * 100}%`;
                }
                
                document.getElementById('dataLoading').style.display = 'none';
                displaySampleData();
                console.log('Dataset generated:', dataset.length, 'samples');
            }, 1000);
        }
        
        function displaySampleData() {
            const table = document.getElementById('sampleData');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            
            // Show first 10 records
            dataset.slice(0, 10).forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.size.toLocaleString()}</td>
                    <td>${row.bedrooms}</td>
                    <td>${row.bathrooms}</td>
                    <td>${row.age}</td>
                    <td>${row.garage ? 'Yes' : 'No'}</td>
                    <td>${row.locationScore}</td>
                    <td>${row.amenityScore}</td>
                    <td>$${row.price.toLocaleString()}</td>
                `;
                tbody.appendChild(tr);
            });
            
            document.getElementById('datasetTable').style.display = 'block';
        }
        
        function downloadCSV() {
            if (dataset.length === 0) {
                alert('Please generate dataset first!');
                return;
            }
            
            // Create CSV content
            const headers = ['Size_sqft', 'Bedrooms', 'Bathrooms', 'Age_years', 'Garage', 'Location_Score', 'Amenity_Score', 'Price'];
            let csvContent = headers.join(',') + '\n';
            
            dataset.forEach(row => {
                const csvRow = [
                    row.size,
                    row.bedrooms,
                    row.bathrooms,
                    row.age,
                    row.garage,
                    row.locationScore,
                    row.amenityScore,
                    row.price
                ].join(',');
                csvContent += csvRow + '\n';
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'house_prices_dataset.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('CSV file downloaded with', dataset.length, 'records');
            alert(`CSV dataset downloaded successfully!\nFile: house_prices_dataset.csv\nRecords: ${dataset.length}\nFeatures: ${headers.length}`);
        }
        
        function preprocessData() {
            if (dataset.length === 0) {
                alert('Please generate dataset first!');
                return;
            }
            
            // Data preprocessing steps
            console.log('Starting data preprocessing...');
            
            // 1. Handle missing values (simulate some missing values)
            let missingCount = 0;
            dataset.forEach(row => {
                if (Math.random() < 0.02) { // 2% missing values
                    row.age = Math.floor(Math.random() * 50); // Fill with random
                    missingCount++;
                }
            });
            
            // 2. Remove outliers (prices beyond 3 standard deviations)
            const prices = dataset.map(row => row.price);
            const mean = prices.reduce((a, b) => a + b) / prices.length;
            const std = Math.sqrt(prices.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / prices.length);
            
            const beforeCount = dataset.length;
            dataset = dataset.filter(row => 
                Math.abs(row.price - mean) <= 3 * std
            );
            const outlierCount = beforeCount - dataset.length;
            
            // 3. Feature scaling (normalize numerical features)
            const features = ['size', 'age', 'locationScore', 'amenityScore'];
            const scalingFactors = {};
            
            features.forEach(feature => {
                const values = dataset.map(row => row[feature]);
                const min = Math.min(...values);
                const max = Math.max(...values);
                scalingFactors[feature] = { min, max };
                
                // Min-max normalization
                dataset.forEach(row => {
                    row[feature + '_scaled'] = (row[feature] - min) / (max - min);
                });
            });
            
            console.log(`Preprocessing complete:
                - Handled ${missingCount} missing values
                - Removed ${outlierCount} outliers
                - Normalized features: ${features.join(', ')}
                - Final dataset size: ${dataset.length} samples`);
            
            alert(`Data preprocessing completed!\n- Fixed ${missingCount} missing values\n- Removed ${outlierCount} outliers\n- Normalized key features\n- Ready for training!`);
        }
        
        function trainModel() {
            if (dataset.length === 0) {
                alert('Please generate and preprocess dataset first!');
                return;
            }
            
            console.log('Training linear regression model...');
            
            // Prepare features and target
            const X = dataset.map(row => [
                row.size, row.bedrooms, row.bathrooms, 
                row.age, row.garage, row.locationScore, row.amenityScore
            ]);
            const y = dataset.map(row => row.price);
            
            // Split data (80% train, 20% test)
            const splitIndex = Math.floor(dataset.length * 0.8);
            const X_train = X.slice(0, splitIndex);
            const y_train = y.slice(0, splitIndex);
            const X_test = X.slice(splitIndex);
            const y_test = y.slice(splitIndex);
            
            // Train model
            model = new LinearRegression();
            const trainingTime = model.fit(X_train, y_train);
            
            // Make predictions
            const y_pred_train = model.predict(X_train);
            const y_pred_test = model.predict(X_test);
            
            // Calculate metrics
            const r2_train = calculateR2(y_train, y_pred_train);
            const r2_test = calculateR2(y_test, y_pred_test);
            const mae_test = calculateMAE(y_test, y_pred_test);
            const accuracy = Math.max(0, (1 - mae_test / mean(y_test)) * 100);
            
            // Display results
            document.getElementById('accuracy').textContent = `${accuracy.toFixed(1)}%`;
            document.getElementById('r2Score').textContent = r2_test.toFixed(3);
            document.getElementById('meanError').textContent = `$${Math.round(mae_test).toLocaleString()}`;
            document.getElementById('trainingTime').textContent = `${trainingTime}ms`;
            document.getElementById('modelResults').style.display = 'grid';
            
            // Generate visualizations
            createVisualizationCharts(X_train, y_train, y_pred_train, X_test, y_test, y_pred_test);
            generateInsights(model.weights, r2_test, mae_test, accuracy);
            
            console.log('Model trained successfully!');
            console.log('Weights:', model.weights);
            console.log('Bias:', model.bias);
            console.log('R¬≤ Score:', r2_test);
        }
        
        function predictPrice() {
            if (!model || !model.trained) {
                alert('Please train the model first!');
                return;
            }
            
            // Get input values
            const features = [
                parseFloat(document.getElementById('houseSize').value),
                parseInt(document.getElementById('bedrooms').value),
                parseFloat(document.getElementById('bathrooms').value),
                parseInt(document.getElementById('houseAge').value),
                parseInt(document.getElementById('garage').value),
                parseInt(document.getElementById('locationScore').value),
                parseInt(document.getElementById('amenityScore').value)
            ];
            
            // Make prediction
            const prediction = model.predict([features])[0];
            
            // Display result
            document.getElementById('predictedPrice').textContent = `$${Math.round(prediction).toLocaleString()}`;
            document.getElementById('confidenceLevel').textContent = `Prediction confidence: High (Model R¬≤ = ${(calculateR2(dataset.map(r => r.price), model.predict(dataset.map(r => [r.size, r.bedrooms, r.bathrooms, r.age, r.garage, r.locationScore, r.amenityScore])))).toFixed(3)})`;
            document.getElementById('predictionResult').style.display = 'block';
            
            console.log('Prediction made:', prediction);
        }
        
        // Utility functions
        function calculateR2(actual, predicted) {
            const actualMean = mean(actual);
            const totalSumSquares = actual.reduce((sum, val) => sum + Math.pow(val - actualMean, 2), 0);
            const residualSumSquares = actual.reduce((sum, val, i) => sum + Math.pow(val - predicted[i], 2), 0);
            return 1 - (residualSumSquares / totalSumSquares);
        }
        
        function calculateMAE(actual, predicted) {
            return actual.reduce((sum, val, i) => sum + Math.abs(val - predicted[i]), 0) / actual.length;
        }
        
        function mean(array) {
            return array.reduce((sum, val) => sum + val, 0) / array.length;
        }
        
        function createVisualizationCharts(X_train, y_train, y_pred_train, X_test, y_test, y_pred_test) {
            // Price Distribution Chart
            const priceRanges = ['<200K', '200K-400K', '400K-600K', '600K-800K', '>800K'];
            const priceCounts = [0, 0, 0, 0, 0];
            
            dataset.forEach(row => {
                if (row.price < 200000) priceCounts[0]++;
                else if (row.price < 400000) priceCounts[1]++;
                else if (row.price < 600000) priceCounts[2]++;
                else if (row.price < 800000) priceCounts[3]++;
                else priceCounts[4]++;
            });
            
            if (charts.priceDistribution) charts.priceDistribution.destroy();
            charts.priceDistribution = new Chart(document.getElementById('priceDistributionChart'), {
                type: 'bar',
                data: {
                    labels: priceRanges,
                    datasets: [{
                        label: 'Number of Houses',
                        data: priceCounts,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'House Price Distribution'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Feature Correlation Chart
            const features = ['Size', 'Bedrooms', 'Bathrooms', 'Age', 'Garage', 'Location', 'Amenities'];
            const correlations = [];
            
            for (let i = 0; i < features.length; i++) {
                const featureData = dataset.map(row => {
                    switch(i) {
                        case 0: return row.size;
                        case 1: return row.bedrooms;
                        case 2: return row.bathrooms;
                        case 3: return row.age;
                        case 4: return row.garage;
                        case 5: return row.locationScore;
                        case 6: return row.amenityScore;
                    }
                });
                const prices = dataset.map(row => row.price);
                correlations.push(calculateCorrelation(featureData, prices));
            }
            
            if (charts.featureCorrelation) charts.featureCorrelation.destroy();
            charts.featureCorrelation = new Chart(document.getElementById('featureCorrelationChart'), {
                type: 'bar',
                data: {
                    labels: features,
                    datasets: [{
                        label: 'Correlation with Price',
                        data: correlations,
                        backgroundColor: correlations.map(c => c >= 0 ? 'rgba(76, 175, 80, 0.8)' : 'rgba(244, 67, 54, 0.8)'),
                        borderColor: correlations.map(c => c >= 0 ? 'rgba(76, 175, 80, 1)' : 'rgba(244, 67, 54, 1)'),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Feature Correlation with Price'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: -1,
                            max: 1
                        }
                    }
                }
            });
            
            // Actual vs Predicted Chart
            if (charts.actualVsPredicted) charts.actualVsPredicted.destroy();
            charts.actualVsPredicted = new Chart(document.getElementById('actualVsPredictedChart'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Test Data',
                        data: y_test.map((actual, i) => ({x: actual, y: y_pred_test[i]})),
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        pointRadius: 4
                    }, {
                        label: 'Perfect Prediction',
                        data: [{x: Math.min(...y_test), y: Math.min(...y_test)}, {x: Math.max(...y_test), y: Math.max(...y_test)}],
                        backgroundColor: 'rgba(244, 67, 54, 0.8)',
                        borderColor: 'rgba(244, 67, 54, 1)',
                        type: 'line',
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Actual vs Predicted Prices'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Actual Price ($)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Predicted Price ($)'
                            }
                        }
                    }
                }
            });
            
            // Residual Chart
            const residuals = y_test.map((actual, i) => actual - y_pred_test[i]);
            
            if (charts.residual) charts.residual.destroy();
            charts.residual = new Chart(document.getElementById('residualChart'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Residuals',
                        data: y_pred_test.map((predicted, i) => ({x: predicted, y: residuals[i]})),
                        backgroundColor: 'rgba(156, 39, 176, 0.6)',
                        borderColor: 'rgba(156, 39, 176, 1)',
                        pointRadius: 4
                    }, {
                        label: 'Zero Line',
                        data: [{x: Math.min(...y_pred_test), y: 0}, {x: Math.max(...y_pred_test), y: 0}],
                        backgroundColor: 'rgba(244, 67, 54, 0.8)',
                        borderColor: 'rgba(244, 67, 54, 1)',
                        type: 'line',
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Residual Analysis'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Predicted Price ($)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Residual ($)'
                            }
                        }
                    }
                }
            });
        }
        
        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            return denominator === 0 ? 0 : numerator / denominator;
        }
        
        function generateInsights(weights, r2Score, mae, accuracy) {
            const features = ['Size (sq ft)', 'Bedrooms', 'Bathrooms', 'Age (years)', 'Garage', 'Location Score', 'Amenity Score'];
            
            // Key Findings
            const keyFindings = [
                `Model achieves ${accuracy.toFixed(1)}% accuracy with R¬≤ score of ${r2Score.toFixed(3)}`,
                `Average prediction error is ${Math.round(mae).toLocaleString()}`,
                `Model successfully captures ${(r2Score * 100).toFixed(1)}% of price variance`,
                `Linear regression proves effective for house price prediction`,
                `Dataset contains ${dataset.length} properties with 7 key features`
            ];
            
            // Feature Importance (based on absolute weights)
            const featureImportance = weights.map((weight, i) => ({
                feature: features[i],
                weight: Math.abs(weight),
                impact: weight > 0 ? 'increases' : 'decreases'
            })).sort((a, b) => b.weight - a.weight);
            
            const featureImportanceText = featureImportance.slice(0, 5).map((item, i) => 
                `${i + 1}. ${item.feature}: ${item.impact} price (impact: ${item.weight.toFixed(0)})`
            );
            
            // Business Recommendations
            const businessRecommendations = [
                'Focus marketing on high-impact features: size, location, and amenities',
                'Properties with garages command significant premium - highlight this feature',
                'Age depreciation is predictable - use for renovation ROI calculations',
                'Location score has strong correlation - invest in neighborhood analysis',
                'Model can be deployed for instant property valuations',
                'Regular retraining recommended as market conditions change'
            ];
            
            // Update HTML
            document.getElementById('keyFindings').innerHTML = keyFindings.map(finding => `<li>${finding}</li>`).join('');
            document.getElementById('featureImportance').innerHTML = featureImportanceText.map(text => `<li>${text}</li>`).join('');
            document.getElementById('businessRecommendations').innerHTML = businessRecommendations.map(rec => `<li>${rec}</li>`).join('');
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('AI House Price Prediction System Initialized');
            console.log('Features: Multiple Linear Regression, Data Preprocessing, Visualization');
        });
    </script>
</body>
</html>
